<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-commerce Supabase</title>
  </head>
  <body>
    <h1>üõçÔ∏è Bienvenue sur mon e-commerce</h1>
    <p id="status">Connexion √† Supabase...</p>

    <script type="module">
      import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

      const SUPABASE_URL = "https://zcfyqmwgzrphiaaqwrde.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjZnlxbXdnenJwaGlhYXF3cmRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjY3MjYsImV4cCI6MjA3NjIwMjcyNn0.hRB156XewgSGH0P2obiFOE-leIwxJ42a5x7AyMmXXEU";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
        global: {
          headers: {
            'x-session-id': localStorage.getItem('session_id') || crypto.randomUUID(),
          },
        },
      });

      let sessionId = localStorage.getItem("session_id");
      if (!sessionId) {
        sessionId = crypto.randomUUID();
        localStorage.setItem("session_id", sessionId);
      }

      document.getElementById("status").textContent =
        "Session visiteur : " + sessionId;

      async function testInsertCart() {
        const { data, error } = await supabase
          .from("carts")
          .insert([{ session_id: sessionId }])
          .select();

        if (error) {
          document.body.innerHTML += `<p style="color:red;">‚ùå Erreur : ${error.message}</p>`;
          console.error(error);
        } else {
          document.body.innerHTML += `<p style="color:green;">‚úÖ Panier cr√©√© : ${JSON.stringify(
            data
          )}</p>`;
        }
      }

      testInsertCart();
    </script>
  </body>
</html>
